<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Mini CMS Notizie e Avvisi</title>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
body { font-family: sans-serif; margin: 2rem; }
label { display: block; margin-top: 1rem; }
input, select, textarea { width: 100%; padding: .3rem; margin-top: .2rem; }
#editor { height: 150px; }
button { margin-top: 1rem; padding: .5rem 1rem; cursor: pointer; }
#msg { margin-top: 1rem; color: green; font-weight: bold; }
</style>
</head>
<body>

<h1>Admin Mini CMS</h1>

<form id="adminForm">
  <label>Titolo
    <input type="text" name="titolo" required>
  </label>

  <label>Testo
    <div id="editor"></div>
  </label>

  <label>Categoria
    <select name="categoria">
      <option>Notizie</option>
      <option>Avvisi</option>
    </select>
  </label>

  <label>
    <input type="checkbox" name="evidenza"> Evidenza
  </label>

  <label>Link esterno (facoltativo)
    <input type="url" name="link" placeholder="https://">
  </label>

  <label>URL Immagine (facoltativo)
    <input type="url" name="immagine" placeholder="https://">
  </label>

  <label>URL Allegato (facoltativo)
    <input type="url" name="allegato" placeholder="https://">
  </label>

  <button type="submit">Salva Notizia</button>
</form>

<div id="msg"></div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzToL5hLZqjj1GSLHmMok_lb3FHqenMVuzeHaR-GS71tVrzJb3yAxSDUpy22osv0HDW/exec"; // <-- sostituisci con la Web App Apps Script

// Inizializza Quill
const quill = new Quill('#editor', { 
  theme: 'snow',
  modules: {
    toolbar: [
      ['bold','italic','underline'],
      ['link'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      ['clean']
    ]
  }
});

const form = document.getElementById("adminForm");
const msg = document.getElementById("msg");

form.addEventListener("submit", e => {
  e.preventDefault();
  const formData = new FormData(form);

  // Aggiunge il contenuto HTML del WYSIWYG
  formData.set("testo", quill.root.innerHTML);

  // Gestione checkbox
  if(!formData.get("evidenza")) formData.set("evidenza","FALSE");
  else formData.set("evidenza","TRUE");

  // Immagine e allegato facoltativi
  formData.set("immagine", formData.get("immagine") || "");
  formData.set("allegato", formData.get("allegato") || "");

  // Invia al Web App
  fetch(WEBAPP_URL, { method: "POST", body: formData })
    .then(res => res.text())
    .then(r => {
      msg.textContent = "Notizia salvata!";
      form.reset();
      quill.setContents([]);
    })
    .catch(err => {
      msg.textContent = "Errore: " + err;
      console.error(err);
    });
});
</script>

</body>
</html>
